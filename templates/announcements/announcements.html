
{% extends 'dashboard_base.html' %}
{% load tz %}
{% load static %}

{% block title %}Announcements - LabangOnline{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/announcements.css' %}" />
{% endblock %}

{% block content %}
<div class="announcements-container">
  <div class="page-header">
    <h1>Barangay Announcements</h1>
    <p>Stay updated with the latest news and events from Barangay Labangon</p>
  </div>

  <div class="filter-section">
    <div class="filter-buttons">
      <button class="filter-btn active" data-type="all">All</button>
      <button class="filter-btn" data-type="general">General</button>
      <button class="filter-btn" data-type="event">Events</button>
      <button class="filter-btn" data-type="alert">Alerts</button>
      <button class="filter-btn" data-type="maintenance">Maintenance</button>
    </div>
  </div>

  {% if announcements %}
  <div class="announcements-grid">
    {% for announcement in announcements %}
    <div class="announcement-card {{ announcement.announcement_type }}" onclick="openModal({{ announcement.id }})">
      <div class="announcement-header">
        <span class="announcement-type type-{{ announcement.announcement_type }}">
          {{ announcement.get_announcement_type_display }}
        </span>
      </div>
      <h3 class="announcement-title">{{ announcement.title }}</h3>
      <div class="announcement-meta">
        <span>ğŸ“… Date Posted: {{ announcement.created_at|timezone:"Asia/Manila"|date:"F d, Y" }}</span>
        <span>ğŸ• Time: {{ announcement.created_at|timezone:"Asia/Manila"|date:"h:i A" }}</span>
      </div>                
      <p class="announcement-content">{{ announcement.content|truncatewords:30 }}</p>
      <div class="announcement-footer">
        <span class="posted-by">
          Posted by: {% if announcement.posted_by %}{{ announcement.posted_by.full_name }}{% else %}Administrator{% endif %}
        </span>
        <span style="color: #10b981; font-size: 0.9rem">Read more â†’</span>
      </div>
    </div>

    <div id="modal-{{ announcement.id }}" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <span class="announcement-type type-{{ announcement.announcement_type }}">
              {{ announcement.get_announcement_type_display }}
            </span>
            <h2 class="modal-title">{{ announcement.title }}</h2>
            <div class="announcement-meta">
              <span>ğŸ“… Date Posted: {{ announcement.created_at|date:"F d, Y" }}</span>
              <span>ğŸ• Time: {{ announcement.created_at|date:"h:i A" }}</span>
            </div>
          </div>
          <button class="modal-close" onclick="closeModal({{ announcement.id }})">&times;</button>
        </div>
        <div class="modal-body">
          <p>{{ announcement.content|linebreaks }}</p>
          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border)">
            <small style="color: var(--text-secondary)">
              Posted by: {% if announcement.posted_by %}{{ announcement.posted_by.full_name }}{% else %}Administrator{% endif %}
            </small>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <img src="{% static 'icons/notification.png' %}" alt="No Announcements" />
    <h3>No Announcements Available</h3>
    <p>There are currently no announcements from the barangay. Check back later for updates!</p>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
  function openModal(id) {
    const modal = document.getElementById(`modal-${id}`);
    if (modal) modal.classList.add("active");
  }

  function closeModal(id) {
    const modal = document.getElementById(`modal-${id}`);
    if (modal) modal.classList.remove("active");
  }

  window.onclick = function(event) {
    if (event.target.classList.contains("modal")) {
      event.target.classList.remove("active");
    }
  };

  (function() {
    const buttons = document.querySelectorAll('.filter-btn');
    const cards = document.querySelectorAll('.announcement-card');
    
    function applyFilter(type) {
      buttons.forEach(b => b.classList.remove('active'));
      const activeBtn = Array.from(buttons).find(b => b.dataset.type === type) || 
                        document.querySelector('.filter-btn[data-type="all"]');
      if (activeBtn) activeBtn.classList.add('active');
      
      cards.forEach(card => {
        if (type === 'all') {
          card.style.display = '';
        } else {
          card.style.display = card.classList.contains(type) ? '' : 'none';
        }
      });
    }
    
    buttons.forEach(btn => {
      btn.addEventListener('click', () => applyFilter(btn.dataset.type));
    });
    
    applyFilter('all');
  })();
</script>
{% endblock %}

