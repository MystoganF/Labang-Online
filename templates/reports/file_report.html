{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}File Report - LabangOnline{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/forms.css' %}" />
<link rel="stylesheet" href="{% static 'css/pages/file_report.css' %}" />
{% endblock %}

{% block page_title %}File Report{% endblock %}

{% block content %}
<div class="content-wrapper">
  <div class="content-right">
    {% if messages %}
    <div class="messages">
      {% for message in messages %}
        {% if message.tags == 'success' %}
          <div class="msg success">{{ message }}</div>
        {% elif message.tags == 'error' %}
          <div class="msg error">{{ message }}</div>
        {% endif %}
      {% endfor %}
    </div>
    {% endif %}
    
    <div class="report-container">
      <!-- Report Header -->
      <div class="report-header">
        <h2>Submit New Report</h2>
        <a href="{% url 'reports:report_records' %}" class="btn-accept">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          View Report Records
        </a>
      </div>
      <p class="report-subtitle">Please provide the report details and select the appropriate category.</p>

      <!-- Info Banner -->
      <div class="info-banner">
        <svg class="info-banner-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div class="info-banner-content">
          <p><strong>Important:</strong> All reports are confidential and will be reviewed within 24 hours. Emergency situations should be reported immediately to authorities.</p>
        </div>
      </div>

      <!-- Report Form -->
      <form method="post" id="reportForm">
        {% csrf_token %}

        <div class="form-row">
          <div class="form-label">REPORT TYPE</div>
          <select class="form-select" name="report_type" id="reportType" required>
            <option value="" disabled selected>Select Report Type</option>
            <option value="Theft">Theft</option>
            <option value="Assault">Assault</option>
            <option value="Vandalism">Vandalism</option>
            <option value="Disturbance">Disturbance</option>
            <option value="Other">Other</option>
          </select>   
        </div>

        <div class="form-row">
          <div class="form-label">PLACE OF INCIDENT</div>
          <input class="form-control" type="text" name="place" id="place" placeholder="e.g., Mako's Bistro on Tres de Abril, Labangon" required />
        </div>

        <div class="form-row">
          <div class="form-label">REPORT MESSAGE</div>
          <textarea class="form-textarea" name="message" id="message" maxlength="1000" placeholder="Describe what happened. Include time, location details, and any identifiers." required></textarea>
          <div class="counter"><span id="charCount">0</span>/1000</div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn-secondary" id="clearBtn">Clear Form</button>
          <button type="submit" class="btn-submit">Submit Report</button>
        </div>
      </form>

      <!-- Support Info -->
      <div class="support">
        Need help? Contact support at 
        <a href="mailto:labangon@gmail.com">labangon@company.com</a>
        or call 
        <a href="tel:+15551234567">(090) 123-4567</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  (function(){
    var message = document.getElementById('message');
    var counter = document.getElementById('charCount');
    var clearBtn = document.getElementById('clearBtn');
    var saveBtn = document.getElementById('saveDraftBtn');

    function updateCount(){ 
      counter.textContent = message.value.length; 
    }

    if(message){ 
      message.addEventListener('input', updateCount); 
      updateCount(); 
    }

    if(clearBtn){
      clearBtn.addEventListener('click', function(){
        document.getElementById('reportType').selectedIndex = 0;
        document.getElementById('place').value = '';
        message.value = '';
        updateCount();
      });
    }

    if(saveBtn){
      saveBtn.addEventListener('click', function(){
        var draft = {
          report_type: document.getElementById('reportType').value,
          place: document.getElementById('place').value,
          message: message.value
        };
        localStorage.setItem('reportDraft', JSON.stringify(draft));
        alert('Draft saved locally.');
      });
    }

    // Load draft on page load
    var savedDraft = localStorage.getItem('reportDraft');
    if(savedDraft){
      try {
        var draft = JSON.parse(savedDraft);
        if(draft.report_type) document.getElementById('reportType').value = draft.report_type;
        if(draft.place) document.getElementById('place').value = draft.place;
        if(draft.message) {
          message.value = draft.message;
          updateCount();
        }
      } catch(e) {
        console.log('Error loading draft');
      }
    }

    // Clear draft on successful submit
    document.getElementById('reportForm').addEventListener('submit', function(){
      localStorage.removeItem('reportDraft');
    });
  })();
</script>
{% endblock %}