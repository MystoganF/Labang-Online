{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}Report Records - LabangOnline{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/report_records.css' %}" />
{% endblock %}

{% block page_title %}Report Records{% endblock %}

{% block content %}
<div class="records-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-top">
      <h1>Incident Report Records</h1>
      <a href="{% url 'reports:file_report' %}" class="new-request-btn">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        File New Report
      </a>
    </div>
    <p>Track and manage all your incident reports in one place</p>
  </div>

  <!-- Summary Cards -->
  <div class="summary-grid">
    <div class="summary-card">
      <div class="summary-label">Total Reports</div>
      <div class="summary-value">{{ total_reports }}</div>
    </div>
    <div class="summary-card pending">
      <div class="summary-label">Pending</div>
      <div class="summary-value">{{ pending_count }}</div>
    </div>
    <div class="summary-card investigation">
      <div class="summary-label">Under Investigation</div>
      <div class="summary-value">{{ investigation_count }}</div>
    </div>
    <div class="summary-card resolved">
      <div class="summary-label">Resolved</div>
      <div class="summary-value">{{ resolved_count }}</div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <form method="GET" id="filterForm">
      <div class="filters-grid">
        <div class="filter-group search-group">
          <label>Search Reports</label>
          <input type="text" name="q" placeholder="Search by report ID, incident type, place, or message..." value="{{ request.GET.q }}">
        </div>
        <div class="filter-group">
          <label>Status</label>
          <select name="status">
            <option value="">All Status</option>
            <option value="Pending" {% if request.GET.status == 'Pending' %}selected{% endif %}>Pending</option>
            <option value="Under Investigation" {% if request.GET.status == 'Under Investigation' %}selected{% endif %}>Under Investigation</option>
            <option value="Mediation Scheduled" {% if request.GET.status == 'Mediation Scheduled' %}selected{% endif %}>Mediation Scheduled</option>
            <option value="Resolved" {% if request.GET.status == 'Resolved' %}selected{% endif %}>Resolved</option>
          </select>
        </div>
        <div class="filter-actions">
          <button type="button" class="btn-clear-filters" onclick="clearFilters()">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            Clear Filters
          </button>
          <button type="submit" class="btn-apply-filters">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
            </svg>
            Apply Filters
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- Records Table -->
  <div class="records-table-wrapper">
    <div class="table-header">
      <h2>Report History</h2>
    </div>

    {% if records %}
    <table class="records-table">
      <thead>
        <tr>
          <th>Report ID</th>
          <th>Type of Incident</th>
          <th>Place of Incident</th>
          <th>Status</th>
          <th>Date Reported</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in records %}
        <tr>
          <td><span class="report-id">{{ r.report_id }}</span></td>
          <td>{{ r.incident_type }}</td>
          <td>{{ r.place }}</td>
          <td>
            {% if r.status == "Under Investigation" %}
              <span class="status-badge under-investigation">{{ r.status }}</span>
            {% elif r.status == "Pending" %}
              <span class="status-badge pending">{{ r.status }}</span>
            {% elif r.status == "Resolved" %}
              <span class="status-badge resolved">{{ r.status }}</span>
            {% elif r.status == "Mediation Scheduled" %}
              <span class="status-badge mediation-scheduled">{{ r.status }}</span>
            {% else %}
              <span class="status-badge">{{ r.status }}</span>
            {% endif %}
          </td>
          <td>{{ r.created_at|date:"M d, Y - h:i A" }}</td>
          <td>
            <a href="{% url 'reports:report_detail' r.report_id %}" class="btn-action btn-view">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
              View
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="empty-state">
      <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
      <h3>No Incident Reports Yet</h3>
      <p>You haven't filed any incident reports. Start by filing a report.</p>
      <a href="{% url 'reports:file_report' %}" class="new-request-btn">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        File Report
      </a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  function clearFilters() {
    window.location.href = "{% url 'reports:report_records' %}";
  }

  // Add any additional JavaScript for reports here
  document.getElementById('filterForm').addEventListener('submit', function(e) {
    // You can add loading state here if needed
  });
</script>
{% endblock %}