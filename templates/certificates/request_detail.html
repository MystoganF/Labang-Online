{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}Request Details - LabangOnline{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/report_detail.css' %}" />
{% endblock %}

{% block page_title %}Request Details{% endblock %}

{% block content %}
<div class="details-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Request Details</h1>
    <a href="{% url 'certificates:certificate_requests' %}" class="back-link">
      <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Requests
    </a>
  </div>

  <!-- Details Grid -->
  <div class="details-grid">
    <!-- Overview Card -->
    <div class="details-card">
      <h2>Overview</h2>
      <div class="details-row">
        <div class="label">Request ID</div>
        <div class="value">{{ cert_request.request_id }}</div>
      </div>
      <div class="details-row">
        <div class="label">Certificate Type</div>
        <div class="value">{{ cert_request.get_certificate_type_display }}</div>
      </div>
      <div class="details-row">
        <div class="label">Purpose</div>
        <div class="value">{{ cert_request.purpose }}</div>
      </div>
      <div class="details-row">
        <div class="label">Created</div>
        <div class="value">{{ cert_request.created_at|date:"M d, Y - h:i A" }}</div>
      </div>
      <div class="details-row">
        <div class="label">Last Updated</div>
        <div class="value">{{ cert_request.updated_at|date:"M d, Y - h:i A" }}</div>
      </div>
    </div>

    <!-- Payment & Claim Card -->
    <div class="details-card">
      <h2>Payment & Claim</h2>
      <div class="details-row">
        <div class="label">Amount</div>
        <div class="value">â‚±{{ cert_request.payment_amount }}</div>
      </div>
      <div class="details-row">
        <div class="label">Payment Mode</div>
        <div class="value">
          {% if cert_request.payment_mode %}
            {{ cert_request.get_payment_mode_display }}
          {% else %}
            <span class="not-selected">Not selected</span>
          {% endif %}
        </div>
      </div>
      <div class="details-row">
        <div class="label">Payment Status</div>
        <div class="value">
          <span class="status-badge {{ cert_request.payment_status }}">
            {{ cert_request.get_payment_status_display }}
          </span>
        </div>
      </div>
      <div class="details-row">
        <div class="label">Reference</div>
        <div class="value">
          {% if cert_request.payment_reference %}
            {{ cert_request.payment_reference }}
          {% else %}
            <span class="not-selected">None</span>
          {% endif %}
        </div>
      </div>
      <div class="details-row">
        <div class="label">Claim Status</div>
        <div class="value">
          <span class="status-badge {{ cert_request.claim_status }}">
            {{ cert_request.get_claim_status_display }}
          </span>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        {% if next_action %}
          <a class="btn" href="{% url next_action.url_name cert_request.request_id %}">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            {{ next_action.label }}
          </a>
        {% endif %}
      </div>
    </div>
    
    <!-- Financial Proof Card (for Indigency) -->
    {% if cert_request.certificate_type == 'indigency' %}
    <div class="details-card">
      <h2>Financial Proof</h2>
      {% if cert_request.proof_photo_url %}
      <div class="proof-image-container">
        <img src="{{ cert_request.proof_photo_url }}" alt="Financial Proof" class="proof-image">
      </div>
      {% elif proof_photo_base64 %}
      <div class="proof-image-container">
        <img src="data:image/jpeg;base64,{{ proof_photo_base64 }}" alt="Financial Proof" class="proof-image">
      </div>
      {% else %}
      <div class="no-proof-message">
        <p>No financial proof image on file for this request.</p>
      </div>
      {% endif %}
    </div>
    {% endif %}
    
    <!-- Business Information Card (for Business Clearance) -->
    {% if cert_request.certificate_type == 'business_clearance' %}
    <div class="details-card">
      <h2>Business Information</h2>
      <div class="details-row">
        <div class="label">Business Name</div>
        <div class="value">{{ cert_request.business_name|default:"Not provided" }}</div>
      </div>
      <div class="details-row">
        <div class="label">Business Type</div>
        <div class="value">{{ cert_request.business_type|default:"Not provided" }}</div>
      </div>
      <div class="details-row">
        <div class="label">Business Nature</div>
        <div class="value">{{ cert_request.business_nature|default:"Not provided" }}</div>
      </div>
      <div class="details-row">
        <div class="label">Business Address</div>
        <div class="value">{{ cert_request.business_address|default:"Not provided" }}</div>
      </div>
      <div class="details-row">
        <div class="label">Number of Employees</div>
        <div class="value">{{ cert_request.employees_count|default:"Not provided" }}</div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<style>
  .not-selected {
    color: #9ca3af;
  }
  
  .proof-image-container {
    text-align: center;
    margin: 20px 0;
  }
  
  .proof-image {
    max-width: 100%;
    max-height: 400px;
    border-radius: 8px;
    border: 1px solid var(--border);
  }
  
  .no-proof-message {
    color: #9ca3af;
    font-size: 14px;
    text-align: center;
  }
</style>
{% endblock %}